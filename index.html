<!--
NASA 천문명리 시스템 (Sky Chronos)
Data: NASA JPL DE440s + SPICE
-->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NASA 천문명리 시스템 (Sky Chronos)</title>
<meta name="description" content="NASA JPL DE440s 천체력과 SPICE 엔진으로 절기·월지·시주를 계산하는 동양 역법 시스템"/>
<script src="asm_full.js"></script>

<style>
body{margin:0;background:#0b1020;color:#e9ecf6;font-family:system-ui;padding:16px;padding-bottom:120px}
.card{background:#101833;border-radius:16px;padding:14px;margin-bottom:12px}
button{width:100%;padding:14px;border-radius:12px;border:none;font-weight:900;background:#6ea8ff;color:#000}
</style>
</head>

<body>
<h1>NASA 천문명리 시스템 (Sky Chronos)</h1>

<div class="card">
<label>날짜</label>
<input id="date" type="date">
<label>시각</label>
<input id="time" type="time">
<button onclick="calc()">NASA 기준 계산</button>
</div>

<div class="card">
<h3>결과</h3>
<div id="out">—</div>
</div>

<div class="card">
<h3>GPT용 출력</h3>
<pre id="raw"></pre>
<button onclick="copy()">GPT로 복사</button>
</div>

<script>
function pad(n){return String(n).padStart(2,'0');}
function toUTC(d,t){
  const [Y,M,D]=d.split('-').map(Number);
  const [h,m]=t.split(':').map(Number);
  return new Date(Date.UTC(Y,M-1,D,h-9,m,0)).toISOString().replace('.000Z','');
}

const terms=["춘분","청명","곡우","입하","소만","망종","하지","소서","대서","입추","처서","백로","추분","한로","상강","입동","소설","대설","동지","소한","대한","입춘","우수","경칩"];
const branches=["자","축","인","묘","진","사","오","미","신","유","술","해"];

function calc(){
  spice.kclear();
  spice.furnsh("naif0012.tls");
  spice.furnsh("pck00010.tpc");
  spice.furnsh("https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/planets/de440s.bsp");

  const d=document.getElementById("date").value;
  const t=document.getElementById("time").value;
  const utc=toUTC(d,t);
  const et=spice.utc2et(utc);

  const pos=spice.spkpos("SUN",et,"ECLIPDATE","LT+S","EARTH");
  const x=pos[0][0],y=pos[0][1];
  let lon=Math.atan2(y,x)*180/Math.PI;
  if(lon<0)lon+=360;

  const termIndex=Math.floor(lon/15);
  const term=terms[termIndex%24];
  const month=branches[(Math.floor((lon-315+360)%360/30)+2)%12];
  const hour=branches[Math.floor(new Date(d+"T"+t).getHours()/2)%12];

  const txt=`절기: ${term}\n월지: ${month}\n시주: ${hour}\n태양황경: ${lon.toFixed(6)}°`;
  document.getElementById("out").innerText=txt;
  document.getElementById("raw").innerText=
`[ASTRONOMICAL BASIS]
UTC: ${utc}
Solar longitude: ${lon.toFixed(9)}
Solar-term: ${term}
Month branch: ${month}
Hour branch: ${hour}`;
}

function copy(){
  navigator.clipboard.writeText(document.getElementById("raw").innerText);
  alert("복사됨");
}
</script>
</body>
</html>
